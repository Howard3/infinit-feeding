version: "3"

tasks:
  dev:
    desc: "run development server"
    cmds:
      - task watch:tailwind & air main.go
  build:dependencies:
    desc: "run dependency builds"
    deps:
      - build:templates
      - build:buf
      - build:tailwind
  build:sqlc:
    desc: "build sqlc code"
    cmds:
      - task: build:sqlc:bulk_uploads
  build:sqlc:bulk_uploads:
    desc: "build sqlc code for bulk uploads"
    dir: internal/bulk_upload/db
    cmds:
      - sqlc generate
  build:templates:
    desc: "build templ files"
    cmds:
      #      - templ fmt ./internal/webapi/templates/
      - templ generate
  build:tailwind:
    desc: "build tailwind css"
    cmds:
      - tailwindcss -i ./static/input.css -o ./static/output.css
  watch:tailwind:
    desc: "watch tailwind css"
    cmds:
      - npx tailwindcss -i ./static/input.css -o ./static/output.css --watch
  build:buf:
    desc: "Generate event go code from proto files if proto files are newer"
    dir: "events"
    cmds:
      - buf generate
  deploy:production:
    desc: "deploy to production"
    cmds:
      - fly deploy -a infinit-feeding
  deploy:staging:
    desc: "deploy to staging"
    cmds:
      - fly deploy -a infinit-feeding-staging
  swagger:
    desc: "generate swagger docs"
    cmds:
      - ./scripts/swagger.sh
  build:docker:
    desc: "build docker image"
    cmds:
      - docker build -t infinit-feeding .
